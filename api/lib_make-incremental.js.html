<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/make-incremental.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/make-incremental.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @copyright Copyright 2016 Kevin Locke &lt;kevin@kevinlocke.name>
 * @license MIT
 */
'use strict';

/** Incrementally compares and reduces an Array-like property of the states
 * using a given comparison function.
 *
 * @ template CompareResult
 * @param {!StreamState} state1 First state to compare.
 * @param {!StreamState} state2 Second state to compare.
 * @param {string} propName Name of Array-like property to compare.
 * @param {function(*, *): CompareResult} compare Comparison function to apply
 * to the &lt;code>propName&lt;/code> values from each state.
 * @return {CompareResult} Result of comparing &lt;code>propName&lt;/code> values, up
 * to the minimum common length.
 * @private
 */
function incrementalProp(state1, state2, propName, compare) {
  var values1 = state1[propName];
  var values2 = state2[propName];

  var result;
  // Note:  Values may be undefined if no data was read.
  if (((values1 &amp;&amp; values1.length !== 0) || state1.ended) &amp;&amp;
      ((values2 &amp;&amp; values2.length !== 0) || state2.ended)) {
    var minLen = Math.min(
        values1 ? values1.length : 0,
        values2 ? values2.length : 0
    );

    if ((values1 &amp;&amp; values1.length > minLen) &amp;&amp; !state2.ended) {
      result = compare(values1.slice(0, minLen), values2);
    } else if ((values2 &amp;&amp; values2.length > minLen) &amp;&amp; !state1.ended) {
      result = compare(values1, values2.slice(0, minLen));
    } else {
      result = compare(values1, values2);
    }

    if (minLen > 0 &amp;&amp; (result === null || result === undefined)) {
      state1[propName] = values1.slice(minLen);
      state2[propName] = values2.slice(minLen);
    }
  }

  return result;
}

/** Makes an incremental comparison and reduction function from a comparison
 * function.
 *
 * Given a function which compares output data (e.g.
 * &lt;code>assert.deepStrictEqual&lt;/code>), this function returns an incremental
 * comparison function which compares only the amount of data output by both
 * streams (unless the stream has ended, in which case all remaining data is
 * compared) and removes the compared data if no comparison result is
 * returned/thrown.
 *
 * @ template CompareResult
 * @param {function((string|Buffer|Array), (string|Buffer|Array)):
 *   CompareResult} compareData Data comparison function which will be called
 * with data output by each stream.
 * @param {?function(!Array&lt;!{name:string,args:Array}>,
 * !Array&lt;!{name:string,args:Array}>): CompareResult=} compareEvents Events
 * comparison function which will be called with the events output by each
 * stream.
 * @returns {function(!StreamState, !StreamState): CompareResult} Incremental
 * comparison function which compares the stream states using
 * &lt;code>compareData&lt;/code> and &lt;code>compareEvents&lt;/code>, and removes
 * compared values if no result is reached.
 * @alias makeIncremental
 */
module.exports = function makeIncremental(compareData, compareEvents) {
  return function incremental(state1, state2) {
    var dataResult = compareData &amp;&amp;
            incrementalProp(state1, state2, 'data', compareData);
    var eventsResult = compareEvents &amp;&amp;
            incrementalProp(state1, state2, 'events', compareEvents);

    return dataResult !== null &amp;&amp; dataResult !== undefined ?
        dataResult :
        eventsResult;
  };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="StreamComparePromise.html">StreamComparePromise</a></li><li><a href="StreamState.html">StreamState</a></li></ul><h3>Global</h3><ul><li><a href="global.html#makeIncremental">makeIncremental</a></li><li><a href="global.html#ReadPolicy">ReadPolicy</a></li><li><a href="global.html#streamCompare">streamCompare</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Apr 22 2016 15:22:52 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
